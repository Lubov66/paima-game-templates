<!DOCTYPE html>
<html>
  <head>
    <title>Doop</title>
  </head>
  <body>
    <div>
      Web worker status:
      <span id="status">
        Loading...
      </span>
    </div>

    <script type="module" async>
      import endpoints from './build/middleware.js';

      // https://github.com/ffmpegwasm/ffmpeg.wasm/issues/694
      function getWorkerURL(e) {
        const t = `window = self; import( "${e}" );`;
        return URL.createObjectURL(new Blob([t], { type: "text/javascript" }));
      }

      const worker = new Worker(getWorkerURL(new URL('./worker.js', window.location)));
      let start = new Date();
      worker.addEventListener('error', e => {
        console.error('error', e);
      });
      worker.addEventListener('messageerror', e => {
        console.error('messageerror', e);
      });
      worker.addEventListener('message', e => {
        console.log('message', e);
        if ('status' in e.data) {
          let now = new Date();
          document.getElementById('status').innerText = e.data.status + ' -- ' + (now.valueOf() - start.valueOf())/1000 + 's';
          start = now;
        }
      });

      //console.log(await endpoints.userWalletLogin({ mode: 0 }));
      await endpoints.sign();
    </script>
  </body>
</html>
